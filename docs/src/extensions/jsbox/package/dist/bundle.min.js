"use strict";
Object.defineProperty(exports, Symbol.toStringTag, { value: "Module" });
const vscode = require("vscode");
function _interopNamespaceDefault(e) {
  const n = Object.create(null, { [Symbol.toStringTag]: { value: "Module" } });
  if (e) {
    for (const k in e) {
      if (k !== "default") {
        const d = Object.getOwnPropertyDescriptor(e, k);
        Object.defineProperty(n, k, d.get ? d : {
          enumerable: true,
          get: () => e[k]
        });
      }
    }
  }
  n.default = e;
  return Object.freeze(n);
}
const vscode__namespace = /* @__PURE__ */ _interopNamespaceDefault(vscode);
function _classCallCheck(a, n) {
  if (!(a instanceof n))
    throw new TypeError("Cannot call a class as a function");
}
function _defineProperties(e, r) {
  for (var t = 0; t < r.length; t++) {
    var o = r[t];
    o.enumerable = o.enumerable || false, o.configurable = true, "value" in o && (o.writable = true), Object.defineProperty(e, _toPropertyKey(o.key), o);
  }
}
function _createClass(e, r, t) {
  return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", {
    writable: false
  }), e;
}
function _toPrimitive(t, r) {
  if ("object" != typeof t || !t)
    return t;
  var e = t[Symbol.toPrimitive];
  if (void 0 !== e) {
    var i = e.call(t, r || "default");
    if ("object" != typeof i)
      return i;
    throw new TypeError("@@toPrimitive must return a primitive value.");
  }
  return ("string" === r ? String : Number)(t);
}
function _toPropertyKey(t) {
  var i = _toPrimitive(t, "string");
  return "symbol" == typeof i ? i : i + "";
}
var JsBoxWebView = /* @__PURE__ */ function() {
  function JsBoxWebView2(path, code, language) {
    _classCallCheck(this, JsBoxWebView2);
    this.path = path;
    this.code = code;
    this.language = language;
    this.panel = vscode__namespace.window.createWebviewPanel(
      "".concat(path),
      // 唯一标识
      "JsBox Page: ".concat(path.replace("wosfs:", "")),
      // 面板标题
      vscode__namespace.ViewColumn.Two,
      // 显示在哪个列
      {
        enableScripts: true,
        // 启用 JavaScript
        retainContextWhenHidden: true,
        // 隐藏时保留上下文
        enableFindWidget: true,
        enableForms: true
      }
      // Webview 选项，可设置更多属性，如 enableScripts 等
    );
    this.load();
  }
  return _createClass(JsBoxWebView2, [{
    key: "html",
    get: function get() {
      if (this.language === "html")
        return this.code;
      return '<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Run Javascript: '.concat(this.path, '</title>\n</head>\n<body>\n    <script type="text/javascript">').concat(this.code, "<\/script>\n</body>\n</html>");
    }
  }, {
    key: "reload",
    value: function reload(code) {
      if (code)
        this.code = code;
      this.panel.reveal();
      this.load();
    }
  }, {
    key: "load",
    value: function load() {
      console.log("reload", this.html);
      this.panel.webview.html = this.html;
    }
  }]);
}();
var JsBoxWebViewManager = /* @__PURE__ */ function() {
  function JsBoxWebViewManager2() {
    _classCallCheck(this, JsBoxWebViewManager2);
    this.map = {};
  }
  return _createClass(JsBoxWebViewManager2, [{
    key: "run",
    value: function run(_ref) {
      var path = _ref.path, code = _ref.code, language = _ref.language;
      if (!this.map[path]) {
        this.map[path] = new JsBoxWebView(path, code, language);
      } else {
        this.map[path].reload(code);
      }
    }
  }]);
}();
function activate(context) {
  var manager = new JsBoxWebViewManager();
  var disposable = vscode__namespace.commands.registerCommand("JsBox.Run", function() {
    var editor = vscode__namespace.window.activeTextEditor;
    if (editor) {
      var code = editor.document.getText();
      var language = editor.document.languageId;
      var path = editor.document.uri.toString();
      manager.run({
        code,
        path,
        language
      });
    } else {
      vscode__namespace.window.showErrorMessage("No active editor found.");
    }
  });
  context.subscriptions.push(disposable);
}
exports.activate = activate;
